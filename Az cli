provider "azurerm" {
  features {}
}

resource "azurerm_resource_group" "example" {
  name     = "example-resources"
  location = "East US"
}

resource "null_resource" "deploy_user_flow_xml" {
  triggers = {
    always_run = "${timestamp()}"
  }

  provisioner "local-exec" {
    command = <<EOT
      # Define your Azure AD B2C Tenant ID, Client ID, and Client Secret
      $tenantId     = "<Your Azure AD B2C Tenant ID>"
      $clientId     = "<Your Azure AD B2C Application (client) ID>"
      $clientSecret = "<Your Azure AD B2C Application client secret>"

      # Define the XML file path
      $xmlFilePath  = "${path.module}/user_flow_config.xml"

      # Sign in with service principal
      az login --service-principal --tenant $tenantId --client-id $clientId --client-secret $clientSecret

      # Upload the XML user flow configuration
      az ad b2c policy set --name B2C_1A_CustomPolicy --policy-id B2C_1A_CustomPolicy --content @$xmlFilePath --debug
    EOT
  }
}
